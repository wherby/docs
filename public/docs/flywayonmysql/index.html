<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="description" content="Description for doradilla library.">
<meta name="generator" content="Paradox, paradox-material-theme=0.6.0, mkdocs-material=3.0.3">

<meta name="lang:clipboard.copy" content="Copy to clipboard">
<meta name="lang:clipboard.copied" content="Copied to clipboard">
<meta name="lang:search.language" content="">
<meta name="lang:search.pipeline.stopwords" content="true">
<meta name="lang:search.pipeline.trimmer" content="true">
<meta name="lang:search.result.none" content="No matching documents">
<meta name="lang:search.result.one" content="1 matching document">
<meta name="lang:search.result.other" content="# matching documents">
<meta name="lang:search.tokenizer" content="[\s\-]+">


<meta name="description" content="Description for doradilla library.">
<link rel="shortcut icon" href="../assets/images/favicon.png">
<title>Flyway clean failed on mysql8 Â· Docs</title>
<link rel="stylesheet" href="../assets/stylesheets/application.451f80e5.css">
<link rel="stylesheet" href="../lib/material__tabs/dist/mdc.tabs.min.css">
<link rel="stylesheet" href="../lib/prettify/prettify.css">
<script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
<style>
body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}
code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}
</style>
<link rel="stylesheet" href="../assets/fonts/font-awesome.css">
<link rel="stylesheet" href="../assets/fonts/material-icons.css">
<link rel="stylesheet" href="../assets/stylesheets/paradox-material-theme.css">
</head>
<body
>
<input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
<input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
<label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
<header class="md-header" data-md-component="header">
<nav class="md-header-nav md-grid">
<div class="md-flex">
<div class="md-flex__cell md-flex__cell--shrink">
<a href="../index.html" title="Docs" class="md-header-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
</div>
<div class="md-flex__cell md-flex__cell--stretch">
<div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
<span class="md-header-nav__topic">
Docs
</span>
<span class="md-header-nav__topic">
Flyway clean failed on mysql8
</span>
</div>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
<label class="md-icon md-search__icon" for="__search"></label>
<button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">&#xE5CD;</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix>
<div class="md-search-result" data-md-component="result">
<div class="md-search-result__meta">
Type to start searching
</div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>

</div>
<div class="md-flex__cell md-flex__cell--shrink">
<div class="md-header-nav__source">
<a href="https://github.com/wherby/docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
wherby/docs
</div>
</a>

</div>
</div>
</div>
</nav>
</header>

<div class="md-container">
<main class="md-main">
<div class="md-main__inner md-grid" data-md-component="container">
<div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--primary" data-md-level="0" style="visibility: hidden">
<label class="md-nav__title md-nav__title--site" for="drawer">
<a href="../index.html" title="Docs" class="md-nav__button md-logo">
<span class="md-nav__button md-logo">
<i class="md-icon">local_library</i>
</a>
<a href="../index.html" title="Docs">
Docs
</a>
</label>
<div class="md-nav__source">
<a href="https://github.com/wherby/docs"
title="Go to repository"
class="md-source"
data-md-source="github">
<div class="md-source__icon">
<i class="fa fa-github"></i>
</div>
<div class="md-source__repository">
wherby/docs
</div>
</a>

</div>
<ul>
  <li><a href="../singletruthprinciple.html" class="page">Single truth principle</a></li>
  <li><a href="../database/index.html" class="page">Database Single truth principle</a>
  <ul>
    <li><a href="../database/dbservice.html" class="page">DB service</a></li>
  </ul></li>
  <li><a href="../fieldnull/index.html" class="page">Database null field error</a>
  <ul>
    <li><a href="../fieldnull/code/index.html" class="page">Database define</a></li>
  </ul></li>
  <li><a href="../engagement/index.html" class="page">Engagement entity add to database</a></li>
  <li><a href="../slickqueryfailed/index.html" class="page">Slick query overflow</a></li>
  <li><a href="../shadowquery/index.html" class="page">Shadow query</a></li>
  <li><a href="../inconsistent/index.html" class="page">Inconsistent status</a></li>
  <li><a href="../dailyjob/index.html" class="page">Daily schedule job</a></li>
  <li><a href="../pac4j/index.html" class="page">Oauth2 client for Pac4j</a></li>
  <li><a href="../nio/index.html" class="page">NIO and Akka-Http</a>
  <ul>
    <li><a href="../nio/code/appacheMPMEvent.html" class="page">Apache MPM event</a></li>
    <li><a href="../nio/code/scalableIOInJava.html" class="page">Scalable IO in Java</a></li>
  </ul></li>
  <li><a href="../databasewithfile/index.html" class="page">Store file in database</a></li>
  <li><a href="../flywayonmysql/index.html" class="active page">Flyway clean failed on mysql8</a></li>
  <li><a href="../iefrontend/index.html" class="page">IE issues for javascript</a></li>
  <li><a href="../apicall/index.html" class="page">Api call failed</a></li>
  <li><a href="../systemdesign/index.html" class="page">software architecture</a>
  <ul>
    <li><a href="../systemdesign/sub/reality.html" class="page">What&rsquo;s reality of software development?</a></li>
    <li><a href="../systemdesign/sub/issues.html" class="page">What&rsquo;re challenges of software development?</a></li>
    <li><a href="../systemdesign/sub/reactive.html" class="page">The reactive manifesto</a></li>
    <li><a href="../systemdesign/sub/doradilla.html" class="page">Doradilla design</a></li>
    <li><a href="../systemdesign/sub/reference.html" class="page">References</a></li>
  </ul></li>
  <li><a href="../poiexcel/index.html" class="page">Excel reader using POI</a></li>
  <li><a href="../future/index.html" class="page">Future value</a></li>
  <li><a href="../lockless/index.html" class="page">Lockless design</a></li>
  <li><a href="../upgradeissue/index.html" class="page">Upgrade issue for authentication</a></li>
  <li><a href="../dbinsert/index.html" class="page">DB bulk insert</a></li>
  <li><a href="../react/index.html" class="page">React web render</a></li>
  <li><a href="../oom/index.html" class="page">Out of memory for batch job</a></li>
  <li><a href="../purefunction/index.html" class="page">Pure function design</a></li>
  <li><a href="../codeissue/index.html" class="page">Code issue</a></li>
  <li><a href="../timeout/index.html" class="page">Timeout errors and crash</a></li>
</ul>
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../flywayonmysql/index.html#flyway-clean-failed-on-mysql8" class="header">Flyway clean failed on mysql8</a>
  <ul>
    <li><a href="../flywayonmysql/index.html#issue" class="header">Issue</a></li>
    <li><a href="../flywayonmysql/index.html#how-the-issue-happens-" class="header">How the issue happens?</a></li>
  </ul></li>
</ul>
</nav>

</nav>
<ul style="display: none">
<li class="md-nav__item md-version" id="project.version">
<label class="md-nav__link" for="__version">
<i class="md-icon" title="Version">label_outline</i> 0.1.0*
</label>
</li>
</ul>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">Table of contents</label>
<ul>
  <li><a href="../flywayonmysql/index.html#flyway-clean-failed-on-mysql8" class="header">Flyway clean failed on mysql8</a>
  <ul>
    <li><a href="../flywayonmysql/index.html#issue" class="header">Issue</a></li>
    <li><a href="../flywayonmysql/index.html#how-the-issue-happens-" class="header">How the issue happens?</a></li>
  </ul></li>
</ul>
</nav>

</div>
</div>
</div>
<div class="md-content">
<article class="md-content__inner md-typeset">
<div class="md-content__searchable">
<h1><a href="#flyway-clean-failed-on-mysql8" name="flyway-clean-failed-on-mysql8" class="anchor"><span class="anchor-link"></span></a>Flyway clean failed on mysql8</h1>
<h2><a href="#issue" name="issue" class="anchor"><span class="anchor-link"></span></a>Issue</h2>
<p>The command as belpw is used for clean database schema:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/wherby/docs/tree/master/docs/src/main/paradox/flywayonmysql/code/command.scala" target="_blank" title="Go to snippet source"></a><code class="language-scala">val cmds = Seq(
  &quot;sbt flyway/flywayClean&quot;,
  &quot;sbt flyway/flywayBaseline&quot;,
  &quot;sbt flyway/flywayMigrate&quot;
)</code></pre>
<p>but this command will failed on mysql 8.0 for &ldquo;sbt flyway/flywayClean&rdquo; as below:</p>
<p><img src="./pic/cleanfailed.png" alt="clean failed" /></p>
<p>When the database is drop by user and use the same sequence commands, the commands will success (there is no cleanup operation because the database is not existed yet). But the commands sequence will still failed on next round on cleanup operation.</p>
<p>While this issue will not occur with mysql 5.7.</p>
<h2><a href="#how-the-issue-happens-" name="how-the-issue-happens-" class="anchor"><span class="anchor-link"></span></a>How the issue happens?</h2>
<p>Because there is one database migration file defined as below:</p>
<pre class="prettyprint"><a class="icon go-to-source" href="https://github.com/wherby/docs/tree/master/docs/src/main/paradox/flywayonmysql/code/procedure.sql" target="_blank" title="Go to snippet source"></a><code class="language-sql">DELIMITER $$
DROP PROCEDURE IF EXISTS `createUserFundForFund` $$
CREATE PROCEDURE `createUserFundForFund` (fiId VARCHAR(256))
BEGIN
  drop temporary table if exists invResult;
 ...
  insert into userfunds (id, userid, fundid, active, deleted, createdatetime, meta) select * from newUserfunds;

END $$
DELIMITER ï¼

DELIMITER $$

DROP PROCEDURE IF EXISTS `createUserFundForAllFunds` $$
CREATE PROCEDURE `createUserFundForAllFunds`()
BEGIN

...

END $$

DELIMITER ;

CALL createUserFundForAllFunds();</code></pre>
<p>The migration will create two procedures in database but not removed. The procedure will only affect mysql 8.0. </p>
</div>
<div>
<a href="https://github.com/wherby/docs/tree/master/docs/src/main/paradox/flywayonmysql/index.md" title="Edit this page" class="md-source-file md-edit">
Edit this page
</a>
</div>
<div class="print-only">
<span class="md-source-file md-version">
0.1.0*
</span>
</div>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-nav">
<nav class="md-footer-nav__inner md-grid">
<a href="../databasewithfile/index.html" title="Store file in database" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
</div>
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Previous
</span>
Store file in database
</span>
</div>
</a>
<a href="../iefrontend/index.html" title="IE issues for javascript" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
<div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
<span class="md-flex__ellipsis">
<span class="md-footer-nav__direction">
Next
</span>
IE issues for javascript
</span>
</div>
<div class="md-flex__cell md-flex__cell--shrink">
<i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
</div>
</a>
</nav>
</div>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
Powered by
<a href="https://github.com/lightbend/paradox">Paradox</a>
and
<a href="https://jonas.github.io/paradox-material-theme/">Paradox Material Theme</a>

</div>
<div class="md-footer-social">
<a href="https://github.com/wherby" class="md-footer-social__link fa fa-github"></a><a href="https://wherby.github.io" class="md-footer-social__link fa fa-globe"></a>
</div>

</div>
</div>
</footer>

</div>
<script src="../assets/javascripts/application.583bbe55.js"></script>
<script src="../assets/javascripts/paradox-material-theme.js"></script>
<script>app.initialize({version:"0.17",url:{base:"../."}})</script>
<script type="text/javascript" src="../lib/prettify/prettify.js"></script>
<script type="text/javascript" src="../lib/prettify/lang-scala.js"></script>
<script type="text/javascript">
document.addEventListener("DOMContentLoaded", function(event) {
window.prettyPrint && prettyPrint();
});
</script>
<script>!function(e,a,t,n,o,c,i){e.GoogleAnalyticsObject=o,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),i=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",i.parentNode.insertBefore(c,i)}(window,document,"script",0,"ga"),ga("create","UA-43080126-2"),ga("set","anonymizeIp",!0),ga("send","pageview");var links=document.getElementsByTagName("a");Array.prototype.map.call(links,function(e){e.host!=document.location.host&&e.addEventListener("click",function(){var a=e.getAttribute("data-md-action")||"follow";ga("send","event","outbound",a,e.href)})});if(document.forms.search){var query=document.forms.search.query;query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}</script>

</body>
</html>
